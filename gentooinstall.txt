/* Install Gentoo */

#Check Connection

ping gentoo.org

#Prepare Disk

fdisk /dev/nvme0n1

g
n


+1G

t
1

n


+16G

t
19

n

# Use the p key to display (print) the disk's current partition configuration onto the screen to ensure everything is correct before permanantly writing the changes to the disk

p

# Use the w key to write the disk's current partition configuration:
w

# Create an MS-DOS file system under Linux on the selected partition vfat with FAT-size type of file allocation tables 32 bit
#https://linux.die.net/man/8/mkfs.vfat

mkfs.vfat -F 32 /dev/nvme0n1p1

# mke2fs is used to create an ext2, ext3, or ext4 filesystem, usually in a disk partition. device is the special file corresponding to the device (e.g /dev/hdXX). blocks-count is the number of blocks on the device.

mkfs.ext4 /dev/nvme0n1p4
#
mkwap /dev/nvme0n1p3
swapon /dev/nvme0n1p3

mkdir -p /mnt/gentoo
mount /dev/nvme0n1p4 /mnt/gentoo
cd /mnt/gentoo
date
links https://gentoo.org/downloads/mirrors
ls
tar xpvf stage3* --xattrs-include='*.*' --numeric-owner
cd etc/portage


/* MAKE.CONF */

# https://devmanual.gentoo.org/eclass-reference/make.conf/index.html
# https://wiki.gentoo.org/wiki/GCC_optimization

vim make.conf



--march=native
MAKEOPTS="-j6 -l6"
EMERGE_DEFAULT_OPTS="${EMERGE_DEFAULT_OPTS} --jobs 6 --load-average 6"
GRUB_PLATFORMS="efi-64"


USE="-gnome -kde -bluetooth"

mirrorselect -i -o >> /mnt/gentoo/etc/portage/make.conf
mkdir --parents /mnt/gentoo/etc/portage/repos.conf
cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf
cp --dereference /etc/resolv.conf /mnt/gentoo/proc/


/* Mount */


mount --types proc /proc /mnt/gentoo/proc
mount --rbind /sys /mnt/gentoo/sys
mount --make-rslave /mnt/gentoo/sys
mount --rbind /dev /mnt/gentoo/dev
mount --make-rslave /mnt/gentoo/dev
mount --bind /run /mnt/gentoo/run
mount --make-slave /mnt/gentoo/run




chroot /mnt/gentoo/ /bin/bash

source /etc/profile && env-update

mount /dev/nvme0n1p1 /boot

echo uwu > /etc/hostname

uwu /etc # cat resolv.conf
# Generated by dhcpcd from enp4s0u2.dhcp
# /etc/resolv.conf.head can replace this line
nameserver 192.168.176.73
# /etc/resolv.conf.tail can replace this line





/* Portage with Git */

# https://wiki.gentoo.org/wiki/Portage_with_Git

emerge -av dev-vcs/git eselect-repository
eselect repository remove gentoo
eselect repository add gentoo git https://github.com/gentoo-mirror/gentoo.git
portageq repos_config /

rm -r /var/db/repos/gentoo
emaint sync -r gentoo




/* Selecting a profile */

eselect profile list

eselect profile set






/* GCC_optimization */

emerge -av app-portage/cpuid2cpuflags

cpuid2cpuflags

echo "*/* $(cpuid2cpuflags)" >> /etc/portage/package.use/00cpuflags

COMMON_FLAGS="-O2 -march=znver2 -pipe"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
FCFLAGS="${COMMON_FLAGS}"
FFLAGS="${COMMON_FLAGS}"





/* Updating the system */
emerge --ask --verbose --update --deep --newuse @world




/* Portage Features */
# https://devmanual.gentoo.org/eclass-reference/make.conf/index.html
#Enable aftter installing debugedit, CFLAGS is set to include -ggdb flag, and binpkg-dostrip is enabled

#FEATURES="buildpkg installsources binpkg-docompress parallel-fetch python-trace splitdebug unmerge-backup compressdebug binpkg-logs \
#binpkg-docompress"

FEATURES="buildpkg binpkg-docompress parallel-fetch python-trace unmerge-backup"

passwd

echo "America/New_York" > /etc/timezone

emerge --config  sys-libs/timezone-data

emerge -av vim gentoo-syntax

vim /etc/locale.gen

locale-gentoo

eselect locale list

env-update && source /etc/profile

/* Microcode & Firmware */

# https://wiki.gentoo.org/wiki/Microcode

echo "sys-kernel/linux-firmware @BINARY-REDISTRIBUTABLE" | tee -a /etc/portage/package.license

emerge -av sys-kernel/linux-firmware sys-apps/pciutils grub os-prober

/* Editing the fstab file */

# https://wiki.gentoo.org/wiki//etc/fstab
# The fstab (file system table) file (/etc/fstab) is a configuration file that defines how and where the main filesystems are to be mounted, especially at boot time.

vim /etc/fstab

/dev/nvme0n1p1 /boot vfat
/dev/nvme0n1p4 /     ext4
/dev/nvme0n1p3 swap  swap

vim /etc/hostname
uwu

rc-update add dhcpcd default
rc-service dhcpcd start

ifconfig

vim /etc/conf.d/net

config_enp4s0u2="dhcp"

ln -s net.low net.enp4s0u2
rc-update add net.enp4s0u2 default




vim /etc/portage/make.conf


/* Creating a new user with and add a home directory */

#Use the -m (--create-home) option to create the user home directory as /home/username, add that user to the specified groups, and specify the shell the user will use

useradd -m -G users,wheel,audio,video,games,plugdev,floppy,cdrom,usb,pipewire,input,users,nikku -s /bin/bash
passwd nikku

/* Installing tools */

emerge -av sys-fs/e2fsprogs sys-fs/xfsprogs sys-fs/reiserfsprogs sys-fs/jfsutils sys-fs/dosfstools sys-fs/btrfs-progs sys-fs/zfs



/* Editing the grub configuration and installing the bootloader
# https://wiki.gentoo.org/wiki/GRUB#Setting_configuration_parameters

vim /etc/default/grub
GRUB_DISABLE_OS_PROBER=false

grub-install --target=x86_64-efi --efi-directory=/boot/ --bootloader-id=Gentoo
grub-mkconfig -o /boot/grub/grub.cfg

/* Rebooting the system */

exit

cd

umount -l /mnt/gentoo/dev{/shm,/pts,}

umount -R /mnt/gentoo

reboot

/* Video Drivers */
#https://wiki.gentoo.org/wiki/AMDGPU

#Check the output for the product names
lspci | grep -i VGA

VIDEO_CARDS="amdgpu radeonsi"



ACCEPT_KEYWORDS="~amd64"

X xinerama elogind dbus pipewire pipewire-alsa sound-server vulkan jumbo-build \
     systemd wayland -bluetooth"

eselect repository add zugina mva gentoo guru amano-kenji


vim /etc/portage/package.use/kitemodels kde-frameworks/kitemmodels qml

kde-frameworks/kconfig qml

vim /etc/portage/package.use/libsndfile minimal

media-video/ffmpeg -sdl

emerge -avUN --autounmask gui-wm/hyprland gui-apps/waybar =gui-apps/hyprpaper-9999 =gui-libs/xdg-desktop-portal-hyprland-9999 sys-auth/seatd app-admin/conky app-misc/wayland-utils dev-libs/wayland-protocols dev-libs/weston dev-util/vulkan-tools gui-apps/grim gui-apps/rofi-wayland gui-apps/slurp gui-apps/swaybg gui-apps/swaylock-effects gui-apps/wl-clipboard gui-apps/wlr-randr gui-apps/wtype gui-libs/wlroots gui-libs/xdg-desktop-portal-wlr kde-plasma/xdg-desktop-portal-kde gui-wm/sway virtual/jack gui-wm/gamescope x11-misc/sddm kde-plasma/sddm-kcm media-video/pipewire media-video/wireplumber media-libs/amdvlk media-libs/glfw   media-libs/vulkan-layers media-libs/vulkan-loader media-plugins/gst-plugins-vaapi media-video/mpv media-video/obs-studio x11-apps/mesa-progs x11-misc/appmenu-gtk-module x11-misc/dunst x11-terms/alacritty x11-terms/kitty x11-terms/wezterm gui-apps/nwg-launchers


media-libs/libsdl2 media-libs/gst-plugins-base gui-libs/wpebackend-fdo media-video/vlc net-misc/freerdp net-libs/webkit-gtk gui-libs/gtk gui-libs/gtk-layer-shell x11-libs/wxGTK x11-libs/gtk+ x11-libs/libxkbcommon xfce-base/libxfce4windowing xfce-base/xfce4-panel media-libs/libva

catch
playerctl

media-fonts/liberation-fonts









gui-libs/xdg-desktop-portal-hyprland-9999 gui-apps/waybar-9999 gui-wm/hyprland-9999 media-libs/openvr-9999 gui-apps/hyprpaper-9999 dev-cpp/nlohmann_json-9999
